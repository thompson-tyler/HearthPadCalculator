<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>Pad Calculator</title>
    <script>
        function drawStone() {
            let ctx = document.getElementById("pad-canvas").getContext("2d");

            let width = getParam("width");
            let depth = getParam("depth");
            let r_clear = getParam("rear-clearance");
            let f_clear = getParam("front-clearance");
            let side_clear = 8;

            let is_corner = document.getElementById("pad-style").value == "Corner";

            if (is_corner) {

                // overall width
                let w_major = r_clear + (width + depth + f_clear) / Math.SQRT2;

                // let bevel_width = 17 + 3 / 16;
                let bevel_width = w_major * 0.3;

                // small side width
                // let w_minor = r_clear + (depth + f_clear) / Math.SQRT2;
                let w_minor = w_major - bevel_width / Math.SQRT2;

                // diagonal from corner to chamfer
                let diag = w_minor * Math.SQRT2 + bevel_width / 2;

                let scale = 0.8 * Math.min(ctx.canvas.width, ctx.canvas.height) / w_major;

                // clear canvas
                ctx.canvas.width = ctx.canvas.width;

                let margin = 60;
                ctx.translate(margin, margin);

                // draw hearth pad
                ctx.beginPath();
                ctx.moveTo(0, 0);
                ctx.lineTo(0, w_major * scale);
                ctx.lineTo(w_minor * scale, w_major * scale);
                ctx.lineTo(w_major * scale, w_minor * scale);
                ctx.lineTo(w_major * scale, 0);
                ctx.closePath();
                ctx.stroke();

                // draw fireplace
                // ctx.beginPath();
                // ctx.moveTo(r_clear * scale, (r_clear + width / Math.SQRT2) * scale);
                // ctx.lineTo((r_clear + depth / Math.SQRT2) * scale, (r_clear + (width + depth) / Math.SQRT2) * scale);
                // ctx.lineTo((r_clear + (width + depth) / Math.SQRT2) * scale, (r_clear + depth / Math.SQRT2) * scale);
                // ctx.lineTo((r_clear + width / Math.SQRT2) * scale, r_clear * scale);
                // ctx.closePath();
                // ctx.stroke();

                // large side width measurement (top)
                ctx.beginPath();
                ctx.moveTo(0, -margin / 2);
                ctx.lineTo(scale * w_major / 2 - 30, -margin / 2);
                ctx.moveTo(scale * w_major / 2 + 30, -margin / 2);
                ctx.lineTo(scale * w_major, -margin / 2);
                ctx.stroke();

                // left arrow
                ctx.beginPath();
                ctx.moveTo(0, -30);
                ctx.lineTo(10, -margin / 2 + 5);
                ctx.lineTo(10, -margin / 2 - 5);
                ctx.fill();

                // right arrow
                ctx.beginPath();
                ctx.moveTo(scale * w_major, -margin / 2);
                ctx.lineTo(scale * w_major - 10, -margin / 2 + 5);
                ctx.lineTo(scale * w_major - 10, -margin / 2 - 5);
                ctx.fill();

                // large side width measurement (right)
                ctx.beginPath();
                ctx.moveTo(-margin / 2, 0);
                ctx.lineTo(-margin / 2, scale * w_major / 2 - 20);
                ctx.moveTo(-margin / 2, scale * w_major / 2 + 10);
                ctx.lineTo(-margin / 2, scale * w_major);
                ctx.stroke();

                // top arrow
                ctx.beginPath();
                ctx.moveTo(-margin / 2, 0);
                ctx.lineTo(-margin / 2 - 5, 10);
                ctx.lineTo(-margin / 2 + 5, 10);
                ctx.fill();

                // bottom arrow
                ctx.beginPath();
                ctx.moveTo(-margin / 2, scale * w_major);
                ctx.lineTo(-margin / 2 - 5, scale * w_major - 10);
                ctx.lineTo(-margin / 2 + 5, scale * w_major - 10);
                ctx.fill();

                // width measurement
                ctx.beginPath();
                ctx.moveTo(0, scale * w_major + 20);
                ctx.lineTo(scale * w_minor / 2 - 30, scale * w_major + 20);
                ctx.moveTo(scale * w_minor / 2 + 30, scale * w_major + 20);
                ctx.lineTo(scale * w_minor, scale * w_major + 20);
                ctx.stroke();

                // left arrow
                ctx.beginPath();
                ctx.moveTo(2, scale * w_major + 20);
                ctx.lineTo(10, scale * w_major + 25);
                ctx.lineTo(10, scale * w_major + 15);
                ctx.fill();

                // right arrow
                ctx.beginPath();
                ctx.moveTo(scale * w_minor, scale * w_major + 20);
                ctx.lineTo(scale * w_minor - 10, scale * w_major + 25);
                ctx.lineTo(scale * w_minor - 10, scale * w_major + 15);
                ctx.fill();

                // diagonal measurement
                ctx.beginPath();
                ctx.setLineDash([5, 5]);
                ctx.moveTo(0, 0);
                ctx.lineTo(scale * w_major / 2 - 20, scale * w_major / 2 - 20);
                ctx.moveTo(scale * w_major / 2 + 10, scale * w_major / 2 + 10);
                ctx.lineTo((w_minor + (w_major - w_minor) / 2) * scale, (w_minor + (w_major - w_minor) / 2) * scale);
                ctx.stroke();

                ctx.font = "20px Times";
                ctx.textAlign = "center";
                // large side width measurement text
                ctx.fillText(Math.round(w_major * 100) / 100 + "\"", -margin / 2, scale * w_major / 2);
                ctx.fillText(Math.round(w_major * 100) / 100 + "\"", scale * w_major / 2, -margin / 2 + 5);
                // small side width measurement text
                ctx.fillText(Math.round(w_minor * 100) / 100 + "\"", scale * w_minor / 2, scale * w_major + 25);
                // diagonal measurement text
                ctx.fillText(Math.round(diag * 100) / 100 + "\"", scale * w_major / 2, scale * w_major / 2);

                document.getElementById("rec-pad").innerHTML = getCornerPad(w_major);
            } else {

                let stone_width = 2 * side_clear + width;
                let stone_depth = r_clear + depth + f_clear;
                let bevel_size = (stone_width - width) / 2;

                let scale = 0.8 * Math.min(ctx.canvas.width / stone_width, ctx.canvas.height / stone_depth);

                // clear canvas
                ctx.canvas.width = ctx.canvas.width;

                let margin = 60;
                ctx.translate(0, margin);

                let xCenter = ctx.canvas.width / 2;

                // draw hearth pad
                ctx.beginPath();
                ctx.moveTo(xCenter - (stone_width / 2) * scale, 0);
                ctx.lineTo(xCenter - (stone_width / 2) * scale, (stone_depth - bevel_size) * scale);
                ctx.lineTo(xCenter - (stone_width / 2 - bevel_size) * scale, stone_depth * scale);
                ctx.lineTo(xCenter + (stone_width / 2 - bevel_size) * scale, stone_depth * scale);
                ctx.lineTo(xCenter + (stone_width / 2) * scale, (stone_depth - bevel_size) * scale);
                ctx.lineTo(xCenter + (stone_width / 2) * scale, 0);
                ctx.closePath();
                ctx.stroke();

                // draw fireplace
                // ctx.beginPath();
                // ctx.moveTo(xCenter - (width / 2) * scale, r_clear * scale);
                // ctx.lineTo(xCenter - (width / 2) * scale, (r_clear + depth) * scale);
                // ctx.lineTo(xCenter + (width / 2) * scale, (r_clear + depth) * scale);
                // ctx.lineTo(xCenter + (width / 2) * scale, r_clear * scale);
                // ctx.closePath();
                // ctx.stroke();

                // depth measurement
                ctx.beginPath();
                ctx.moveTo((xCenter - scale * stone_width / 2) / 2, 0);
                ctx.lineTo((xCenter - scale * stone_width / 2) / 2, scale * stone_depth / 2 - 20);
                ctx.moveTo((xCenter - scale * stone_width / 2) / 2, scale * stone_depth / 2 + 10);
                ctx.lineTo((xCenter - scale * stone_width / 2) / 2, scale * stone_depth);
                ctx.stroke();

                // top arrow
                ctx.beginPath();
                ctx.moveTo((xCenter - scale * stone_width / 2) / 2, 0);
                ctx.lineTo((xCenter - scale * stone_width / 2) / 2 - 5, 10);
                ctx.lineTo((xCenter - scale * stone_width / 2) / 2 + 5, 10);
                ctx.fill();

                // bottom arrow
                ctx.beginPath();
                ctx.moveTo((xCenter - scale * stone_width / 2) / 2, scale * stone_depth);
                ctx.lineTo((xCenter - scale * stone_width / 2) / 2 - 5, scale * stone_depth - 10);
                ctx.lineTo((xCenter - scale * stone_width / 2) / 2 + 5, scale * stone_depth - 10);
                ctx.fill();

                // width measurement
                ctx.beginPath();
                ctx.moveTo(xCenter - scale * stone_width / 2, -margin / 2);
                ctx.lineTo(xCenter - 30, -margin / 2);
                ctx.moveTo(xCenter + 30, -margin / 2);
                ctx.lineTo(xCenter + scale * stone_width / 2, -margin / 2);
                ctx.stroke();

                // left arrow
                ctx.beginPath();
                ctx.moveTo(xCenter - scale * stone_width / 2, -margin / 2);
                ctx.lineTo(xCenter - scale * stone_width / 2 + 10, -margin / 2 - 5);
                ctx.lineTo(xCenter - scale * stone_width / 2 + 10, -margin / 2 + 5);
                ctx.fill();

                // right arrow
                ctx.beginPath();
                ctx.moveTo(xCenter + scale * stone_width / 2, -margin / 2);
                ctx.lineTo(xCenter + scale * stone_width / 2 - 10, -margin / 2 - 5);
                ctx.lineTo(xCenter + scale * stone_width / 2 - 10, -margin / 2 + 5);
                ctx.fill();

                ctx.font = "20px Times";
                ctx.textAlign = "center";
                // width measurement text
                ctx.fillText(Math.round(stone_width * 100) / 100 + "\"", xCenter, -margin / 2 + 5);
                // depth measurement text
                ctx.fillText(Math.round(stone_depth * 100) / 100 + "\"", (xCenter - scale * stone_width / 2) / 2, scale * stone_depth / 2);

                document.getElementById("rec-pad").innerHTML = getStandardPad(stone_width, stone_depth);
            }
        }
        function getParam(id) {
            let param = Math.abs(parseInt(document.getElementById(id + "-input").value));
            param += parseFloat(document.getElementById(id + "-frac").value);
            return param;
        }
        function addFractions(id) {
            let select = document.getElementById(id);

            let opt = document.createElement("option");
            opt.value = 0;
            opt.innerHTML = " ";
            select.appendChild(opt);

            // generates fractions from 1/8 to 7/8
            for (let i = 1; i < 8; i++) {

                let num = i;
                let den = 8;

                while (den % 2 == 0 && num % 2 == 0) {
                    num /= 2;
                    den /= 2;
                }

                let opt = document.createElement("option");
                opt.value = num / den;
                opt.innerHTML = num + "/" + den;
                select.appendChild(opt);
            }
        }

        let message_prepend = "Recommended Hearth Pad: ";
        let err_message = "Due to its large size, this pad will need to be custom ordered";

        let corner_pads = new Map();
        corner_pads.set(32.25, "C-32");
        corner_pads.set(36.25, "C-36");
        corner_pads.set(40.25, "C-40");
        corner_pads.set(48.25, "C-48");
        corner_pads.set(54.25, "C-54");
        corner_pads.set(60.25, "C-60");

        function getCornerPad(min_width) {
            for (let [width, part] of corner_pads) {
                if (width >= min_width)
                    return message_prepend + part;
            }
            return err_message;
        }

        let standard_pads = new Map();
        standard_pads.set([32.25, 26.25], "W-3226");
        standard_pads.set([32.25, 32.25], "W-32");
        standard_pads.set([36.25, 36.25], "W-36");
        standard_pads.set([40.25, 40.25], "W-40");
        standard_pads.set([40.25, 48.25], "W-4048");
        standard_pads.set([48.25, 48.25], "W-48");
        standard_pads.set([48.25, 54.25], "W-4854");
        standard_pads.set([54.25, 54.25], "W-54");
        standard_pads.set([60.25, 60.25], "W-60");

        function getStandardPad(min_width, min_depth) {
            for (let [size, part] of standard_pads) {
                if (size[0] >= min_width && size[1] >= min_depth)
                    return message_prepend + part;
            }
            return err_message;
        }
    </script>
</head>

<body>
    <table align="center">
        <tr>
            <td style="padding-right: 20px;">
                <div align="center">
                    <form onsubmit="drawStone(); return false" autocomplete="off">
                        <table style="color: black;">
                            <tr>
                                <td style="text-align: right;">Style: </td>
                                <td>
                                    <select id="pad-style" align="center">
                                        <option>Standard</option>
                                        <option>Corner</option>
                                    </select>
                                </td>
                            </tr>
                            <tr>
                                <td style="text-align: right;">Stove Width: </td>
                                <td>
                                    <input type="text" id="width-input" style="background-color: white; text-align: right; border: grey solid 1pt;" size="2" required
                                        pattern="[0-9]+"
                                        title="Must be a positive whole number. Use dropdown for decimals"></input>
                                    - <select id="width-frac"></select>
                                </td>
                                <td>in</td>
                            </tr>
                            <tr>
                                <td style="text-align: right;">Stove Depth: </td>
                                <td>
                                    <input type="text" id="depth-input" style="background-color: white; text-align: right; border: grey solid 1pt;" size="2" required
                                        pattern="[0-9]+"
                                        title="Must be a positive whole number. Use dropdown for decimals"></input>
                                    - <select id="depth-frac"></select>
                                </td>
                                <td>in</td>
                            </tr>
                            <tr>
                                <td style="text-align: right;">Rear Corner Clearance: </td>
                                <td>
                                    <input type="text" id="rear-clearance-input" style="background-color: white; text-align: right; border: grey solid 1pt;" size="2"
                                        required pattern="[0-9]+"
                                        title="Must be a positive whole number. Use dropdown for decimals"></input>
                                    - <select id="rear-clearance-frac"></select>
                                </td>
                                <td>in</td>
                            </tr>
                            <tr>
                                <td style="text-align: right;">Front Clearance: </td>
                                <td>
                                    <input type="text" id="front-clearance-input" style="background-color: white; text-align: right; border: grey solid 1pt;" size="2"
                                        required pattern="[0-9]+"
                                        title="Must be a positive whole number. Use dropdown for decimals"></input>
                                    - <select id="front-clearance-frac"></select>
                                </td>
                                <td>in</td>
                            </tr>
                        </table>
                        <div align="center">
                            <button type="submit">Submit</button>
                        </div>
                    </form>
                </div>
            </td>
            <td>
                <div align="center">
                    <canvas id="pad-canvas" width="500" height="500"></canvas>
                </div>
            </td>
        </tr>
        <tr>
            <td></td>
            <td style="text-align: center;">
                <a id="rec-pad" style="font-weight: bold; text-decoration: underline;" href="https://graysenwoods.com/pdf/gw_brochure.pdf" target="_blank"></a>
            </td>
        </tr>
    </table>
    <script>
        addFractions("width-frac");
        addFractions("depth-frac");
        addFractions("rear-clearance-frac");
        addFractions("front-clearance-frac");
    </script>
</body>

</html>